# Docs Reference Refinement Tranches

This plan sequences the remaining docs-reference quality work after parser launch and initial `docs-ref` modernization.

## Tranche A — Summary/Length Normalization + Fallback Elimination (P0)

### Objective
Eliminate low-quality autogenerated summaries and fallback-only pages, starting with heavy offenders in `stats` and `math`.

### Scope
- Rust docstrings in `crates/formualizer-eval/src/builtins/stats/mod.rs`
- Rust docstrings in `crates/formualizer-eval/src/builtins/math/*.rs`
- `xtask docs-ref` summary normalization heuristics (already started)

### Targets
- `## Formula example` fallback pages: drive to ~0 in stats/math
- Legacy summary style (`X(...) - Returns ...`) eliminated
- Frontmatter `description` consistently concise

### Acceptance checks
- `rg -l "^## Formula example$" docs-site/content/docs/reference/functions | wc -l` → target near zero
- `rg -l "description: \".* - Returns" docs-site/content/docs/reference/functions | wc -l` → zero

---

## Tranche B — SEO Metadata + Structured Article Signals (P0)

### Objective
Improve search quality and snippet usefulness for generated function pages.

### Scope
- `xtask docs-ref` frontmatter generation polish
  - normalize descriptions
  - enforce safe length bounds
- Add deterministic structured data patterns where appropriate
  - breadcrumb/article-level schema strategy for reference pages
- Ensure parser and docs routes interlink cleanly

### Targets
- Unique, non-spammy metadata on generated pages
- Better SERP snippet quality
- Strong internal linking from quickstarts/reference/playground into parser and function pages

### Acceptance checks
- no overlong/templated frontmatter descriptions
- sitemap + robots + canonical routes remain valid
- docs-site build clean

---

## Tranche C — Related Function Relevance Refinement (P1)

### Objective
Upgrade related-function quality from simple same-category neighbors to behavior-aware recommendations.

### Scope
- Extend `xtask docs-ref` related selection:
  1. explicit `yaml,docs.related`
  2. known semantic pairings (e.g., LOOKUP families)
  3. category fallback
- Add stable sorting and dedupe logic

### Targets
- Related lists feel useful, not arbitrary
- Better click depth within reference section

### Acceptance checks
- spot-check top 50 functions for related relevance
- no self-links or duplicate related entries

---

## Tranche D — Parallel FAQ Enrichment Swarm (P1)

### Objective
Populate function-specific, high-value FAQ entries at scale using colocated Rust docstrings (`yaml,docs`).

### Scope
- Rust docstrings only (no docs-site/manual mdx edits)
- `yaml,docs` blocks with:
  - `faq: [{q,a}, ...]`
  - optional `related` hints

### Dispatch plan
- Wave 1: `stats` + `math`
- Wave 2: `lookup` + `reference-fns`
- Wave 3: `text` + `logical` + `info`
- Wave 4: `financial` + `engineering` + `datetime` + `database`
- Wave 5: `lambda` + `random` + QA cleanup

### Subagent guardrails
- no regen commands
- no script-based bulk rewrites
- no subagent re-dispatch
- 1–3 FAQs per function
- FAQs must be behavior-specific (error/edge semantics preferred)

### Acceptance checks
- FAQ coverage threshold achieved (target category-based)
- low duplication of q/a pairs
- regenerated pages show FAQ sections where provided

---

## Tranche E — QA + Publish Readiness (P0 final gate)

### Objective
Finalize docs quality and SEO readiness before broad promotion.

### Scope
- Full docs regen (`xtask docs-ref --apply`)
- build verification (`docs-site npm run build`)
- quality checks:
  - fallback count
  - summary quality
  - related/faq rendering sanity

### Exit criteria
- no critical fallbacks in high-traffic categories
- parser route stable
- reference pages readable and SEO-ready
- deployment checks pass
